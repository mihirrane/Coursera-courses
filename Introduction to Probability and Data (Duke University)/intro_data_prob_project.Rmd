---
title: "Exploring the BRFSS data"
output: 
    keep_md: true
    rmarkdown::github_document
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

```{r global_options}
knitr::opts_chunk$set(fig.path='Figs/')
```

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(grid)
library(gridBase)
library(purrr)
```

### Load data

Make sure your data and R Markdown files are in the same directory. When loaded
your data file will be called `brfss2013`. Delete this note when before you submit 
your work. 

```{r load-data}
load("brfss2013.RData")
```

* * *

## Part 1: Data

In the brfss, stratified sampling was used, random sampling was done. But there is no random assignment.Participants were not randomly assigned to the tasks such as sleeping, exercising etc. So this is a observational study and so is generalizable but causality cannot be inferred.

* * *

## Part 2: Research questions

**Research quesion 1:**
For the general population in the US, is there relationship between exercising in last 30 days and income. Is there a difference based on employment status?


**Research quesion 2:**
For the general population in the US, is there a relation between ethnicity and life satisfaction. There has been lot of news correlating ethnic groups with life satisfaction, I want to inspect whether there is a relation between a particular ethnicity group and their life satisfaction. Is there a difference in results between genders?


**Research quesion 3:**
For the general population in the US, is there a correlation between the hours of sleep an individual gets night before and their energy levels next morning. Is there a difference in energy levels between genders?


* * *

## Part 3: Exploratory data analysis

**Research quesion 1:**
For the general population in the US, is there relationship between exercising in last 30 days and income. Is there a difference based on employment status?

```{r}
# Remove all data with NA's.
exercise.income.na <- filter(brfss2013, !is.na(exerany2), !is.na(income2), !is.na(employ1))

# Find porportion that does any exercise grouped by income.
exercise.income <- exercise.income.na %>% group_by(income2) %>% summarise(prop_exer = sum(exerany2 == "Yes") / n())

# Print
exercise.income
```


```{r}

levels(exercise.income$income2) <- gsub(" ", "\n", levels(exercise.income$income2))
ggplot(exercise.income, aes(income2, prop_exer)) +
    geom_point(aes(income2, prop_exer)) +
    labs(title="Amount of people who exercised in last 30 days vs. income", x="Income", y="Amount of people who exercised in last 30 days")

```

There appears to be a very strong relationship between exercising and income. Again there this observational study will not lead to any causality,we can see that higher income groups do more exercise.


```{r}
# Find porportion that does any exercise grouped by employment status.
exercise.income.employ <- exercise.income.na %>% group_by(employ1) %>% summarise(prop_exer = sum(exerany2 == "Yes") / n())

# Print
exercise.income.employ
```

```{r}

levels(exercise.income.employ$employ1) <- gsub(" ", "\n", levels(exercise.income.employ$employ1))
ggplot(exercise.income.employ, aes(employ1, prop_exer)) +
    geom_point(aes(employ1, prop_exer)) +
    labs(title="Amount of people who exercised in last 30 days vs employment status",
         x="employment status", y="Amount of people who exercised in last 30 days")
```

The employment status with clearly the largest proportion reporting having exercised in last 30 days is “A student”. And the one with the lowest is “Out of work for 1 year or more”. Does lack of work lead to decreased motivation and thus less amount of exercise?

```{r}
chisq.test(exercise.income$income2, exercise.income$prop_exer, correct = FALSE)
```

The p-value is greater than 0.05 although there is a clear indication from exploratory analysis that there is dependence between income groups and amount of exercise. The chi-square test suggests otherwise.

```{r}

chisq.test(exercise.income.employ$employ1, exercise.income.employ$prop_exer, correct = TRUE)
```

The p-value is greater than 0.05 although there is a clear indication from exploratory analysis that there is dependence between employment status and amount of exercise. The chi-square test suggests otherwise.

**Research quesion 2:**
For the general population in the US, is there a relation between ethnicity and life satisfaction. There has been lot of news correlating ethnic groups with life satisfaction, I want to inspect whether there is a relation between a particular ethnicity group and their life satisfaction. Is there a difference in results between genders?

```{r}

ggplot(data=brfss2013, aes(x=X_race)) +geom_bar(stat='count') +theme(axis.text.x = element_text(angle = 45, hjust = 1))
   
```
From the above plot, we can see that the majority population is "white only" followed by "black only" and other ethnicities respectively.

```{r}
ggplot(data=brfss2013, aes(x=lsatisfy)) +geom_bar(stat='count') +theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
From the above plot, we can see that most data on life satisfaction is missing. Accurate results are not guaranteed because of lack of data on life satisfaction.

```{r}
race.satisfaction <- select(brfss2013, X_race , sex , lsatisfy) %>% 
  filter(!is.na(X_race), !is.na(sex), !is.na(lsatisfy) )

race.satisfaction %>% group_by(X_race) %>%  summary(count=n())
```


```{r}
ggplot(data = race.satisfaction, aes(x = X_race, y = lsatisfy)) +
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)   +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    facet_grid(. ~  sex) +
    xlab("Ethnicity") +
    ylab ("Life satisfaction")
```


```{r}

ggplot(race.satisfaction %>% count(X_race, sex) %>%
                  mutate(pct=n/sum(n),ypos = cumsum(n) - 0.5*n),
       aes(X_race,n, fill = sex)) +
      geom_bar(stat="identity")+
      theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

We can see that the dataset contains higher females per category.

```{r}

ggplot(race.satisfaction %>% count(lsatisfy, sex) %>%
                  mutate(pct=n/sum(n),ypos = cumsum(n) - 0.5*n),
       aes(lsatisfy,n, fill = sex)) +
      geom_bar(stat="identity")+
      theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

We can observe that there is higher life satisfation among females over males.

```{r}
chisq.test(race.satisfaction$X_race, race.satisfaction$lsatisfy, correct = FALSE)
```

The p-value is less than 0.05 thus we can conclude that there is dependence between life satisfaction and ethnicity.

```{r}
chisq.test(race.satisfaction$lsatisfy, race.satisfaction$sex, correct = FALSE)
```

The p-value is less than 0.05 thus we can conclude that there is dependence between life satisfaction and sex


```{r}
males <- race.satisfaction[which(race.satisfaction$sex == "Male"),]

ggplot(males %>% count(X_race, lsatisfy) %>%
                  mutate(pct=n/sum(n),ypos = cumsum(n) - 0.5*n),
       aes(X_race,n, fill = lsatisfy)) +
      geom_bar(stat="identity")+
      theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
females <- race.satisfaction[which(race.satisfaction$sex == "Female"),]

ggplot(females %>% count(X_race, lsatisfy) %>%
                  mutate(pct=n/sum(n),ypos = cumsum(n) - 0.5*n),
       aes(X_race,n, fill = lsatisfy)) +
      geom_bar(stat="identity")+
      theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

We can observe that there is a correlation between ethnic groups and life satisfaction. The pattern does not vary based on gender. Although the count of males and females vary as the dataset contains more females as compared to males. 

**Research quesion 3:**
For the general population in the US, is there a correlation between the hours of sleep an individual gets night before and their energy levels next morning. Is there a difference in energy levels between genders?

```{r}
## Sleep time less than 12 hours
health.sleep <- select(brfss2013, qlhlth2 , sex , sleptim1) %>% 
  filter(!is.na(qlhlth2), !is.na(sex), sleptim1 <= 12 )

health.sleep %>% group_by(qlhlth2) %>%  summary(count=n())

```

```{r}
ggplot(data = health.sleep, aes(x = sleptim1, y = qlhlth2 ))+
    geom_point(shape=1) +    # Use hollow circles
    geom_smooth(method=lm)   +
    scale_x_continuous(limits = c(4,10), breaks = 4:10) +
    facet_grid(. ~  sex) +
    xlab("sleptim1 = Hours of Sleep") +
    ylab ("qlhlth2: Days of full energy in the last 30 days")
```

There seems to be a generally positive correlation between the hours of sleep and days of full energy. The correlation seems to be slightly stronger for females than males as the males data is more widely dispersed.
